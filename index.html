<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Link — Your Personal AI Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .phone-bezel { background:#1a1a1a; padding:10px; border-radius:40px; box-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 10px 10px -5px rgba(0,0,0,.04), inset 0 0 0 2px #333; }
    .phone-screen { background:white; border-radius:30px; overflow:hidden; aspect-ratio:9/19.5; display:flex; flex-direction:column; position:relative; }
    .notch { background:#1a1a1a; width:150px; height:25px; border-radius:0 0 15px 15px; position:absolute; top:10px; left:50%; transform:translateX(-50%); z-index:20; }
    .message-box { position:fixed; top:20px; right:20px; color:white; padding:15px 20px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.15); opacity:0; transform:translateY(-20px); transition:opacity .3s, transform .3s; z-index:1000; }
    .message-box.show { opacity:1; transform:translateY(0); }
    .message-box.success { background:#28a745; }
    .message-box.error { background:#dc3545; }
    .chat-bubble { max-width:85%; padding:10px 15px; border-radius:20px; margin-bottom:8px; word-wrap:break-word; }
    .chat-bubble-received { background:#e5e7eb; color:#1f2937; align-self:flex-start; }
    .chat-bubble-sent { background:#3b82f6; color:white; align-self:flex-end; }
    input:disabled, button:disabled { opacity:.5; cursor:not-allowed; }

    /* Modal overlay stays empty in HTML; we inject content from modal.html */
    #legal-modal {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.5);
      display: flex; align-items: center; justify-content: center;
      z-index: 50;
      opacity: 0; visibility: hidden;
      transition: opacity .3s ease, visibility .3s ease;
    }
    #legal-modal.show { opacity: 1; visibility: visible; }
    .modal-content { background:white; border-radius:20px; width:90%; height:85%; display:flex; flex-direction:column; box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05); }
    .modal-body { overflow-y:auto; padding:20px; }
    .modal-footer { border-top:1px solid #e5e7eb; padding:15px; text-align:center; }
    .dashed-line { border-top:2px dashed #d1d5db; margin:2.5rem 0; }
  </style>
</head>
<body class="bg-gray-800 text-white min-h-screen flex items-center justify-center p-4">

  <div class="w-full max-w-7xl mx-auto flex flex-col lg:flex-row items-center justify-center gap-16">
    <!-- Left: Logo + Headline -->
    <div class="text-center">
      <div class="w-40 h-40 mx-auto mb-8 p-4 rounded-full flex items-center justify-center bg-gradient-to-br from-gray-200 via-gray-400 to-gray-500">
        <!-- Replace this comment with YOUR inline SVG logo -->
        <!-- <svg>…your logo…</svg> -->
      </div>

      <h1 class="text-5xl md:text-6xl font-bold">Goodbye, UI.</h1>
      <h2 class="text-3xl md:text-4xl text-blue-400 mt-2">Hello, Assistant.</h2>
      <p class="mt-6 max-w-lg text-lg text-gray-300 mx-auto">
        AI Link transforms your native messaging app into a powerful personal assistant.
        Schedule meetings, book travel, and coordinate events through simple conversation.
      </p>

      <!-- Visible links to standalone policy pages -->
      <p class="mt-4 text-sm text-gray-300">
        <a href="privacy.html" class="underline underline-offset-4">Privacy Policy</a> •
        <a href="terms.html" class="underline underline-offset-4">Terms of Service</a>
      </p>
    </div>

    <!-- Right: Phone Simulator -->
    <div id="simulator" class="w-full max-w-sm">
      <div class="phone-bezel">
        <div class="phone-screen">
          <div class="notch"></div>
          <div id="screen-content" class="flex-grow flex flex-col justify-between w-full h-full bg-white text-gray-800">
            <!-- Stage 1 -->
            <div id="stage1" class="w-full h-full flex-col">
              <div id="chat-history" class="p-4 pt-20 flex-grow flex flex-col space-y-2">
                <div class="chat-bubble chat-bubble-received">
                  <p class="mb-2">
                    Welcome to AI Link! Before we start, please review and consent to our Terms of Service and Privacy Policy.
                  </p>
                  <button id="view-terms-button" class="w-full bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600">
                    View Policies & How It Works
                  </button>
                </div>
              </div>

              <!-- Opt-in (compliant) -->
              <form id="phone-form" class="p-3 border-t border-gray-200 bg-gray-50 text-gray-900">
                <label for="phone" class="sr-only">Mobile number</label>
                <div class="flex items-center gap-2">
                  <input type="tel" id="phone" name="phone"
                         class="flex-grow bg-gray-200 border-none rounded-full px-4 py-2 focus:ring-0"
                         placeholder="Your mobile number" required disabled inputmode="tel" autocomplete="tel"/>
                  <button type="submit" id="send-button" class="ml-1 p-2" disabled aria-label="Verify & Opt In">
                    <svg class="w-7 h-7 text-blue-600" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.789 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/></svg>
                  </button>
                </div>

                <!-- Separate consents for declared use cases -->
                <fieldset class="mt-3 space-y-2 text-sm">
                  <legend class="text-xs uppercase tracking-wider text-gray-500 mb-1">I want to receive:</legend>
                  <label class="flex items-center gap-2">
                    <input type="checkbox" name="usecase_customer_care" class="accent-blue-600" checked>
                    Customer support & scheduling confirmations (transactional)
                  </label>
                  <label class="flex items-center gap-2">
                    <input type="checkbox" name="usecase_2fa" class="accent-blue-600" checked>
                    Authentication codes (OTP/2FA)
                  </label>
                  <!-- Optional: enable if you file a separate “Events” campaign -->
                  <!--
                  <label class="flex items-center gap-2">
                    <input type="checkbox" name="usecase_events" class="accent-blue-600">
                    Event reminders & updates
                  </label>
                  -->
                </fieldset>

                <!-- Required disclosures -->
                <p class="mt-3 text-xs text-gray-700 leading-relaxed">
                  By providing your phone number, you agree to receive SMS from <strong>AI Link LLC</strong> for the selected purposes above.
                  <em>Message frequency may vary.</em> Message &amp; data rates may apply.
                  Reply <strong>STOP</strong> to unsubscribe, <strong>HELP</strong> for help.
                  See our <a href="privacy.html" class="underline">Privacy Policy</a>.
                </p>
              </form>
            </div>
            <!-- (Future: add stages for OTP, etc.) -->
          </div>

          <!-- Empty overlay container; content injected from modal.html -->
          <div id="legal-modal"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notifications -->
  <div id="notification-message" class="message-box"></div>

  <script>
    const BACKEND_URL = 'https://48dc7f24fde8.ngrok-free.app';

    // Refs
    const viewTermsButton = document.getElementById('view-terms-button');
    const legalModal = document.getElementById('legal-modal');
    const phoneInput = document.getElementById('phone');
    const sendButton = document.getElementById('send-button');
    const phoneForm = document.getElementById('phone-form');
    const chatHistory = document.getElementById('chat-history');
    const notificationMessage = document.getElementById('notification-message');

    function showNotification(message, type='success') {
      notificationMessage.textContent = message;
      notificationMessage.className = `message-box ${type} show`;
      setTimeout(() => notificationMessage.classList.remove('show'), 5000);
    }

    // Load and inject modal.html only when needed
    async function loadModal() {
      try {
        const res = await fetch('modal.html?ts=' + Date.now(), { cache: 'no-store' });
        if (!res.ok) throw new Error('Failed to load modal.html');
        const html = await res.text();
        legalModal.innerHTML = html;

        // Wire up injected elements
        const modalBody = legalModal.querySelector('#modal-body');
        const agreeButton = legalModal.querySelector('#agree-button');

        // Enable Agree after a brief scroll (or immediately if you prefer)
        modalBody.addEventListener('scroll', () => {
          const nearBottom = modalBody.scrollTop + modalBody.clientHeight >= modalBody.scrollHeight - 10;
          if (nearBottom) agreeButton.disabled = false;
        });

        agreeButton.addEventListener('click', () => {
          legalModal.classList.remove('show');
          phoneInput.disabled = false;
          sendButton.disabled = false;

          const agreedBubble = document.createElement('div');
          agreedBubble.className = 'chat-bubble chat-bubble-sent';
          agreedBubble.textContent = 'I agree to the terms and privacy.';
          chatHistory.appendChild(agreedBubble);
          chatHistory.scrollTop = chatHistory.scrollHeight;
        });

        // Close when clicking outside modal content
        legalModal.addEventListener('mousedown', (e) => {
          const content = legalModal.querySelector('.modal-content');
          if (content && !content.contains(e.target)) {
            legalModal.classList.remove('show');
          }
        });

      } catch (err) {
        console.error(err);
        showNotification('Could not load policies modal.', 'error');
      }
    }

    // Open modal on button click
    viewTermsButton.addEventListener('click', async () => {
      if (!legalModal.innerHTML.trim()) {
        await loadModal();
      }
      legalModal.classList.add('show');
    });

    // Submit opt-in (stub to your backend)
    phoneForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const phone = phoneInput.value.trim();
      const usecases = {
        customer_care: phoneForm.querySelector('[name="usecase_customer_care"]')?.checked || false,
        two_fa: phoneForm.querySelector('[name="usecase_2fa"]')?.checked || false,
        // events: phoneForm.querySelector('[name="usecase_events"]')?.checked || false,
      };
      if (!phone) return showNotification('Please enter your mobile number.', 'error');

      try {
        await fetch(`${BACKEND_URL}/api/opt-in`, {
          method: 'POST',
          headers: { 'Content-Type':'application/json' },
          body: JSON.stringify({
            phone,
            usecases,
            consent_ts: new Date().toISOString(),
            consent_text: 'By providing your phone number, you agree to receive SMS from AI Link LLC. Message frequency may vary. Message & data rates may apply. Reply STOP to unsubscribe, HELP for help.'
          })
        });
        showNotification('Thanks! We’ve sent a verification code (if required).');
      } catch (_) {
        showNotification('Could not submit. Please try again.', 'error');
      }
    });
  </script>
</body>
</html>
